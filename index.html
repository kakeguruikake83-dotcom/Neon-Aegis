<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nexus Defense</title>
    <style>
        body { margin: 0; background: #0f172a; color: white; font-family: sans-serif; overflow: hidden; }
        canvas { display: block; background: #1e293b; margin: auto; border: 4px solid #334155; }
        #ui-overlay { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; }
        .btn { background: #3b82f6; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; border: none; color: white; }
    </style>
</head>
<body>

    <div id="stats" style="position: absolute; top: 10px; left: 10px;">
        Ouro: <span id="gold">100</span> | Vidas: <span id="lives">20</span> | Onda: <span id="wave">1</span>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-overlay">
        <button class="btn" onclick="setMode('ARCHER')">Arqueira ($50)</button>
        <button class="btn" onclick="setMode('CANNON')">Canhão ($80)</button>
        <button class="btn" style="background: #ef4444;" onclick="useAbility('METEOR')">METEORO</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth > 800 ? 800 : window.innerWidth;
        canvas.height = 600;

        let gold = 100;
        let lives = 20;
        let enemies = [];
        let towers = [];
        let projectiles = [];

        // Loop Principal
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawPath();
            updateEnemies();
            updateTowers();
            updateProjectiles();
            
            requestAnimationFrame(gameLoop);
        }

        function drawPath() {
            ctx.strokeStyle = "#475569";
            ctx.lineWidth = 40;
            ctx.beginPath();
            ctx.moveTo(0, 300);
            ctx.lineTo(canvas.width, 300);
            ctx.stroke();
        }

        // Lógica de spawn simples
        setInterval(() => {
            enemies.push({ x: 0, y: 300, hp: 50 + (gold/10), speed: 2 });
        }, 2000);

        function updateEnemies() {
            enemies.forEach((enemy, index) => {
                enemy.x += enemy.speed;
                ctx.fillStyle = "#10b981";
                ctx.fillRect(enemy.x, enemy.y - 10, 20, 20);

                if (enemy.x > canvas.width) {
                    enemies.splice(index, 1);
                    lives--;
                    document.getElementById('lives').innerText = lives;
                }
            });
        }

        function updateTowers() {
            towers.forEach(tower => {
                ctx.fillStyle = "#6366f1";
                ctx.beginPath();
                ctx.arc(tower.x, tower.y, 15, 0, Math.PI * 2);
                ctx.fill();

                // Atirar no inimigo mais próximo
                enemies.forEach(enemy => {
                    let dist = Math.hypot(enemy.x - tower.x, enemy.y - tower.y);
                    if (dist < 150 && Date.now() - tower.lastShot > 1000) {
                        projectiles.push({ x: tower.x, y: tower.y, target: enemy, speed: 5 });
                        tower.lastShot = Date.now();
                    }
                });
            });
        }

        function updateProjectiles() {
            projectiles.forEach((p, index) => {
                let dx = p.target.x - p.x;
                let dy = p.target.y - p.y;
                let dist = Math.hypot(dx, dy);
                
                if (dist < 5) {
                    p.target.hp -= 20;
                    if(p.target.hp <= 0) {
                        enemies.splice(enemies.indexOf(p.target), 1);
                        gold += 10;
                        document.getElementById('gold').innerText = gold;
                    }
                    projectiles.splice(index, 1);
                } else {
                    p.x += (dx / dist) * p.speed;
                    p.y += (dy / dist) * p.speed;
                    ctx.fillStyle = "yellow";
                    ctx.fillRect(p.x, p.y, 5, 5);
                }
            });
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            if (gold >= 50) {
                towers.push({ x, y, lastShot: 0 });
                gold -= 50;
                document.getElementById('gold').innerText = gold;
            }
        });

        gameLoop();
    </script>
</body>
</html>
