<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Neon Aegis: Midas Protocol</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #02020f;
  --bg2: #050518;
  --cyan: #00f5ff;
  --magenta: #ff00cc;
  --green: #00ff88;
  --orange: #ff6600;
  --gold: #ffbb00;
  --purple: #aa00ff;
  --blue: #0088ff;
  --red: #ff2244;
  --white: #e0f0ff;
  --dim: rgba(0,245,255,0.08);
  --border: rgba(0,245,255,0.25);
  --glow-c: 0 0 8px #00f5ff, 0 0 20px rgba(0,245,255,0.5);
  --glow-m: 0 0 8px #ff00cc, 0 0 20px rgba(255,0,204,0.5);
  --glow-g: 0 0 8px #00ff88, 0 0 20px rgba(0,255,136,0.5);
  --font-main: 'Orbitron', monospace;
  --font-body: 'Rajdhani', sans-serif;
}
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body {
  width:100%; height:100%; overflow:hidden;
  background:var(--bg); color:var(--white);
  font-family:var(--font-body); font-size:16px;
  touch-action:manipulation;
}

/* ── SCANLINE OVERLAY ── */
body::before {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:9999;
  background:repeating-linear-gradient(0deg,
    transparent, transparent 2px,
    rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
}

/* ── SCREENS ── */
.screen {
  position:fixed; inset:0; display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  background:var(--bg); transition:opacity .3s;
}
.screen.hidden { opacity:0; pointer-events:none; }

/* ── MAIN MENU ── */
#screen-menu {
  background: radial-gradient(ellipse at 50% 30%, rgba(0,245,255,0.06) 0%, var(--bg) 70%);
}
.menu-logo {
  text-align:center; margin-bottom:48px;
}
.menu-logo h1 {
  font-family:var(--font-main); font-size:clamp(22px,6vw,36px);
  font-weight:900; letter-spacing:4px;
  background:linear-gradient(135deg, var(--cyan), var(--magenta));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 12px var(--cyan));
  line-height:1.2;
}
.menu-logo p {
  font-family:var(--font-main); font-size:11px;
  color:rgba(0,245,255,0.5); letter-spacing:8px; margin-top:6px;
}
.menu-logo .subtitle {
  font-family:var(--font-body); font-size:13px;
  color:rgba(255,255,255,0.3); letter-spacing:2px; margin-top:12px;
}
.hex-deco {
  width:80px; height:80px; margin:0 auto 24px;
  position:relative; display:flex; align-items:center; justify-content:center;
}
.hex-deco svg { width:100%; height:100%; }

.menu-btn {
  display:block; width:260px; margin:10px auto; padding:14px 24px;
  font-family:var(--font-main); font-size:13px; font-weight:700;
  letter-spacing:3px; text-align:center; text-transform:uppercase;
  background:transparent; border:1px solid var(--cyan);
  color:var(--cyan); cursor:pointer; position:relative;
  clip-path:polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
  transition:all .2s;
}
.menu-btn::before {
  content:''; position:absolute; inset:0;
  background:var(--cyan); opacity:0; transition:opacity .2s;
  clip-path:polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
}
.menu-btn:hover::before { opacity:0.1; }
.menu-btn:hover { box-shadow:var(--glow-c); }
.menu-btn:active { transform:scale(0.97); }
.menu-btn.secondary { border-color:var(--magenta); color:var(--magenta); }
.menu-btn.secondary:hover { box-shadow:var(--glow-m); }

.version-tag {
  position:absolute; bottom:20px;
  font-size:10px; color:rgba(0,245,255,0.3); letter-spacing:2px;
}

/* ── SELECT SCREENS ── */
.select-title {
  font-family:var(--font-main); font-size:14px; letter-spacing:4px;
  color:var(--cyan); text-align:center; margin-bottom:32px;
  text-shadow:var(--glow-c);
}
.back-btn {
  position:absolute; top:20px; left:20px; padding:8px 16px;
  font-family:var(--font-main); font-size:11px; letter-spacing:2px;
  background:transparent; border:1px solid rgba(0,245,255,0.3);
  color:rgba(0,245,255,0.5); cursor:pointer; transition:all .2s;
}
.back-btn:hover { color:var(--cyan); border-color:var(--cyan); }

.card-grid {
  display:grid; grid-template-columns:1fr 1fr; gap:14px;
  width:min(400px, 90vw); max-height:70vh; overflow-y:auto;
}
.card-grid.single-col { grid-template-columns:1fr; }
.select-card {
  padding:20px 16px; border:1px solid var(--border);
  background:var(--dim); cursor:pointer; position:relative;
  transition:all .2s; text-align:left;
}
.select-card:hover {
  border-color:var(--cyan); background:rgba(0,245,255,0.08);
  box-shadow:var(--glow-c);
}
.card-name {
  font-family:var(--font-main); font-size:12px; font-weight:700;
  color:var(--white); letter-spacing:1px; margin-bottom:6px;
}
.card-desc { font-size:12px; color:rgba(255,255,255,0.5); line-height:1.4; }
.card-badge {
  position:absolute; top:8px; right:8px;
  font-family:var(--font-main); font-size:9px; letter-spacing:1px;
  padding:2px 6px;
}
.badge-easy { border:1px solid var(--green); color:var(--green); }
.badge-medium { border:1px solid var(--cyan); color:var(--cyan); }
.badge-hard { border:1px solid var(--orange); color:var(--orange); }
.badge-nightmare { border:1px solid var(--red); color:var(--red); }

/* ── GAME WRAPPER ── */
#screen-game {
  flex-direction:column; justify-content:flex-start;
  background:var(--bg); padding:0;
  overflow:hidden;
}

/* ── STATUS BAR ── */
#status-bar {
  width:100%; height:44px; flex-shrink:0;
  background:rgba(0,0,0,0.8); border-bottom:1px solid var(--border);
  display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; z-index:10;
}
.stat-item {
  display:flex; align-items:center; gap:6px;
  font-family:var(--font-main); font-size:13px; font-weight:700;
}
.stat-icon { font-size:16px; }
.stat-money { color:var(--gold); text-shadow:0 0 8px var(--gold); }
.stat-lives { color:var(--red); text-shadow:0 0 8px var(--red); }
.stat-wave { color:var(--cyan); text-shadow:var(--glow-c); font-size:11px; }

/* ── CANVAS AREA ── */
#canvas-container {
  flex:1; display:flex; align-items:center; justify-content:center;
  overflow:hidden; position:relative;
}
#gameCanvas {
  display:block; image-rendering:pixelated;
  touch-action:none;
}

/* ── FOOTER ── */
#game-footer {
  width:100%; flex-shrink:0;
  background:rgba(0,0,0,0.9); border-top:1px solid var(--border);
  padding:8px 0 4px; z-index:10;
}
#tower-carousel {
  display:flex; gap:8px; padding:0 8px 8px;
  overflow-x:auto; scrollbar-width:none;
}
#tower-carousel::-webkit-scrollbar { display:none; }

.tower-card {
  flex-shrink:0; width:64px; height:72px;
  border:1px solid rgba(0,245,255,0.2); background:rgba(0,0,0,0.5);
  display:flex; flex-direction:column; align-items:center;
  justify-content:center; gap:4px; cursor:pointer; padding:4px;
  position:relative; transition:all .15s;
  clip-path:polygon(4px 0%, 100% 0%, calc(100% - 4px) 100%, 0% 100%);
}
.tower-card:hover { transform:translateY(-2px); }
.tower-card.selected {
  border-width:2px; background:rgba(0,245,255,0.1);
}
.tower-card.selected.rarity-common { border-color:var(--green); box-shadow:0 0 10px rgba(0,255,136,0.4); }
.tower-card.selected.rarity-rare { border-color:var(--blue); box-shadow:0 0 10px rgba(0,136,255,0.4); }
.tower-card.selected.rarity-epic { border-color:var(--purple); box-shadow:0 0 10px rgba(170,0,255,0.4); }
.tower-card.selected.rarity-legendary { border-color:var(--gold); box-shadow:0 0 10px rgba(255,187,0,0.4); }

.tower-card canvas { width:36px; height:36px; }
.tower-card-name {
  font-family:var(--font-main); font-size:8px; letter-spacing:0.5px;
  text-align:center; color:rgba(255,255,255,0.7);
}
.tower-card-cost {
  font-family:var(--font-main); font-size:9px; font-weight:700;
  color:var(--gold);
}
.rarity-pip {
  position:absolute; top:3px; right:3px;
  width:5px; height:5px; border-radius:50%;
}
.rarity-common .rarity-pip { background:var(--green); box-shadow:0 0 4px var(--green); }
.rarity-rare .rarity-pip { background:var(--blue); box-shadow:0 0 4px var(--blue); }
.rarity-epic .rarity-pip { background:var(--purple); box-shadow:0 0 4px var(--purple); }
.rarity-legendary .rarity-pip { background:var(--gold); box-shadow:0 0 4px var(--gold); }

.footer-controls {
  display:flex; align-items:center; gap:8px; padding:0 8px 4px;
}
#btn-start-wave {
  flex:1; padding:10px; font-family:var(--font-main); font-size:11px;
  font-weight:700; letter-spacing:2px; background:transparent;
  border:1px solid var(--cyan); color:var(--cyan); cursor:pointer;
  transition:all .2s; clip-path:polygon(6px 0%,100% 0%,calc(100% - 6px) 100%,0% 100%);
}
#btn-start-wave:hover { background:rgba(0,245,255,0.15); box-shadow:var(--glow-c); }
#btn-start-wave:disabled { opacity:0.4; cursor:not-allowed; }

.auto-toggle {
  display:flex; flex-direction:column; align-items:center; gap:3px;
}
.auto-label {
  font-family:var(--font-main); font-size:8px;
  color:rgba(0,245,255,0.5); letter-spacing:1px;
}
.toggle-switch {
  width:36px; height:18px; background:rgba(0,0,0,0.5);
  border:1px solid rgba(0,245,255,0.3); border-radius:9px;
  position:relative; cursor:pointer; transition:all .2s;
}
.toggle-switch.on {
  background:rgba(0,245,255,0.2); border-color:var(--cyan);
  box-shadow:var(--glow-c);
}
.toggle-knob {
  position:absolute; top:2px; left:2px;
  width:12px; height:12px; border-radius:50%;
  background:rgba(0,245,255,0.4); transition:left .2s;
}
.toggle-switch.on .toggle-knob { left:20px; background:var(--cyan); }

/* ── TOWER INFO POPUP ── */
#tower-popup {
  position:absolute; z-index:100;
  background:rgba(5,5,24,0.97); border:1px solid var(--border);
  padding:14px; width:200px; pointer-events:all;
  box-shadow:0 0 20px rgba(0,245,255,0.2);
  clip-path:polygon(10px 0%,100% 0%,100% calc(100% - 10px),calc(100% - 10px) 100%,0% 100%,0% 10px);
  transition:opacity .15s;
}
#tower-popup.hidden { opacity:0; pointer-events:none; }
.popup-name {
  font-family:var(--font-main); font-size:12px; font-weight:700;
  margin-bottom:2px;
}
.popup-rarity {
  font-size:10px; letter-spacing:2px; margin-bottom:10px; opacity:0.7;
}
.popup-stats { margin-bottom:10px; }
.popup-stat {
  display:flex; justify-content:space-between; align-items:center;
  font-size:12px; color:rgba(255,255,255,0.7); margin-bottom:4px;
}
.popup-stat-val { color:var(--white); font-weight:600; }
.popup-stat-gain { color:var(--green); font-size:10px; }
.popup-buttons { display:flex; flex-direction:column; gap:6px; }
.popup-btn {
  width:100%; padding:7px; font-family:var(--font-main); font-size:10px;
  font-weight:700; letter-spacing:2px; border:1px solid; background:transparent;
  cursor:pointer; transition:all .15s;
}
.popup-btn-upgrade { border-color:var(--cyan); color:var(--cyan); }
.popup-btn-upgrade:hover { background:rgba(0,245,255,0.1); box-shadow:var(--glow-c); }
.popup-btn-sell { border-color:var(--red); color:var(--red); }
.popup-btn-sell:hover { background:rgba(255,34,68,0.1); }
.popup-btn-ability { border-color:var(--gold); color:var(--gold); }
.popup-btn-ability:hover { background:rgba(255,187,0,0.1); }
.popup-btn:disabled { opacity:0.35; cursor:not-allowed; }
.popup-close {
  position:absolute; top:8px; right:8px; width:18px; height:18px;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; color:rgba(255,255,255,0.4); font-size:14px;
}

/* ── FLOATING MESSAGES ── */
#float-messages { position:absolute; inset:0; pointer-events:none; z-index:50; }
.float-msg {
  position:absolute; font-family:var(--font-main); font-size:12px;
  font-weight:700; pointer-events:none; white-space:nowrap;
  animation:floatUp 1.2s forwards;
}
@keyframes floatUp {
  0% { opacity:1; transform:translateY(0) scale(1); }
  100% { opacity:0; transform:translateY(-50px) scale(0.8); }
}

/* ── WAVE NOTIFICATION ── */
#wave-banner {
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  font-family:var(--font-main); font-size:clamp(18px,5vw,28px);
  font-weight:900; letter-spacing:6px; color:var(--cyan);
  text-shadow:var(--glow-c); pointer-events:none; z-index:200;
  opacity:0; text-align:center;
}
#wave-banner.show { animation:waveBanner 2s forwards; }
@keyframes waveBanner {
  0% { opacity:0; transform:translate(-50%,-50%) scale(0.5); }
  20% { opacity:1; transform:translate(-50%,-50%) scale(1.05); }
  70% { opacity:1; transform:translate(-50%,-50%) scale(1); }
  100% { opacity:0; transform:translate(-50%,-50%) scale(0.95); }
}

/* ── GAME OVER / WIN ── */
#screen-result {
  flex-direction:column; gap:20px;
  background:rgba(0,0,0,0.95);
}
.result-title {
  font-family:var(--font-main); font-size:clamp(28px,8vw,48px);
  font-weight:900; letter-spacing:6px; text-align:center;
}
.result-title.win {
  background:linear-gradient(135deg,var(--gold),var(--orange));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 16px var(--gold));
}
.result-title.lose {
  background:linear-gradient(135deg,var(--red),var(--magenta));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 16px var(--red));
}
.result-stats { text-align:center; color:rgba(255,255,255,0.6); font-size:14px; line-height:2; }
.result-stats span { color:var(--cyan); font-weight:700; }

/* ── UPGRADE SCREEN ── */
#screen-upgrades {
  overflow-y:auto; align-items:flex-start; padding:60px 20px;
}
.upgrade-grid {
  display:grid; grid-template-columns:1fr 1fr; gap:12px;
  width:min(400px,90vw); margin-top:20px;
}
.upgrade-item {
  padding:14px; border:1px solid var(--border); background:var(--dim);
  text-align:center; cursor:pointer; transition:all .2s;
}
.upgrade-item:hover { border-color:var(--gold); background:rgba(255,187,0,0.05); }
.upgrade-item.owned { border-color:var(--green); background:rgba(0,255,136,0.05); }
.upgrade-name { font-family:var(--font-main); font-size:11px; margin-bottom:6px; color:var(--white); }
.upgrade-desc { font-size:11px; color:rgba(255,255,255,0.5); margin-bottom:8px; }
.upgrade-cost { font-family:var(--font-main); font-size:12px; color:var(--gold); }

/* ── SCROLLBARS ── */
::-webkit-scrollbar { width:4px; height:4px; }
::-webkit-scrollbar-track { background:rgba(0,0,0,0.3); }
::-webkit-scrollbar-thumb { background:rgba(0,245,255,0.3); border-radius:2px; }

/* ── COOLDOWN OVERLAY ON ABILITY BTN ── */
.cooldown-bar {
  position:absolute; bottom:0; left:0; height:2px;
  background:var(--gold); transition:width .1s linear;
}
</style>
</head>
<body>

<!-- ════════ SCREEN: MAIN MENU ════════ -->
<div id="screen-menu" class="screen">
  <div class="hex-deco">
    <svg viewBox="0 0 80 80">
      <polygon points="40,4 74,22 74,58 40,76 6,58 6,22" 
        fill="none" stroke="rgba(0,245,255,0.6)" stroke-width="1.5"/>
      <polygon points="40,12 66,26 66,54 40,68 14,54 14,26" 
        fill="none" stroke="rgba(255,0,204,0.3)" stroke-width="1"/>
      <circle cx="40" cy="40" r="8" fill="none" stroke="rgba(0,245,255,0.8)" stroke-width="1.5"/>
      <line x1="40" y1="4" x2="40" y2="22" stroke="rgba(0,245,255,0.4)" stroke-width="1"/>
      <line x1="74" y1="22" x2="66" y2="26" stroke="rgba(0,245,255,0.4)" stroke-width="1"/>
      <line x1="74" y1="58" x2="66" y2="54" stroke="rgba(0,245,255,0.4)" stroke-width="1"/>
      <line x1="40" y1="76" x2="40" y2="68" stroke="rgba(0,245,255,0.4)" stroke-width="1"/>
      <line x1="6" y1="58" x2="14" y2="54" stroke="rgba(0,245,255,0.4)" stroke-width="1"/>
      <line x1="6" y1="22" x2="14" y2="26" stroke="rgba(0,245,255,0.4)" stroke-width="1"/>
    </svg>
  </div>
  <div class="menu-logo">
    <h1>NEON AEGIS</h1>
    <p>MIDAS PROTOCOL</p>
    <div class="subtitle">TOWER DEFENSE v2.0.77</div>
  </div>
  <button class="menu-btn" onclick="showScreen('map')">⬡ JOGAR</button>
  <button class="menu-btn secondary" onclick="showScreen('upgrades')">◈ ATUALIZAÇÕES</button>
  <div class="version-tag">SYS_BUILD 2077 · NEON_AEGIS_CORP</div>
</div>

<!-- ════════ SCREEN: MAP SELECT ════════ -->
<div id="screen-map" class="screen hidden">
  <button class="back-btn" onclick="showScreen('menu')">◄ VOLTAR</button>
  <div class="select-title">» SELECIONE O SETOR «</div>
  <div class="card-grid">
    <div class="select-card" onclick="selectMap(0)">
      <div class="card-name">SETOR ALFA</div>
      <div class="card-desc">Grade 12×16<br>Caminho Espiral</div>
      <div class="card-badge badge-medium">MÉDIO</div>
    </div>
    <div class="select-card" onclick="selectMap(1)">
      <div class="card-name">SETOR BETA</div>
      <div class="card-desc">Grade 14×18<br>Labirinto Neon</div>
      <div class="card-badge badge-hard">DIFÍCIL</div>
    </div>
  </div>
</div>

<!-- ════════ SCREEN: DIFFICULTY SELECT ════════ -->
<div id="screen-difficulty" class="screen hidden">
  <button class="back-btn" onclick="showScreen('map')">◄ VOLTAR</button>
  <div class="select-title">» DIFICULDADE «</div>
  <div class="card-grid single-col" style="width:min(300px,90vw)">
    <div class="select-card" onclick="selectDifficulty('easy')">
      <div class="card-name">FÁCIL</div>
      <div class="card-desc">15 Ondas · Vida extra · Mais ouro</div>
      <div class="card-badge badge-easy">FÁCIL</div>
    </div>
    <div class="select-card" onclick="selectDifficulty('medium')">
      <div class="card-name">MÉDIO</div>
      <div class="card-desc">25 Ondas · Balanceado</div>
      <div class="card-badge badge-medium">MÉDIO</div>
    </div>
    <div class="select-card" onclick="selectDifficulty('hard')">
      <div class="card-name">DIFÍCIL</div>
      <div class="card-desc">40 Ondas · Inimigos mais rápidos</div>
      <div class="card-badge badge-hard">DIFÍCIL</div>
    </div>
    <div class="select-card" onclick="selectDifficulty('nightmare')">
      <div class="card-name">PESADELO</div>
      <div class="card-desc">50 Ondas · Modo extremo</div>
      <div class="card-badge badge-nightmare">PESADELO</div>
    </div>
  </div>
</div>

<!-- ════════ SCREEN: UPGRADES ════════ -->
<div id="screen-upgrades" class="screen hidden">
  <button class="back-btn" onclick="showScreen('menu')">◄ VOLTAR</button>
  <div class="select-title">» ATUALIZAÇÕES GLOBAIS «</div>
  <div style="font-family:var(--font-main);color:var(--gold);font-size:13px;text-align:center;margin-bottom:10px">
    ◈ <span id="upgrade-gems">0</span> CRISTAIS
  </div>
  <div class="upgrade-grid" id="upgrade-grid"></div>
</div>

<!-- ════════ SCREEN: GAME ════════ -->
<div id="screen-game" class="screen hidden">
  <!-- Status bar -->
  <div id="status-bar">
    <div class="stat-item stat-money">
      <span class="stat-icon">◈</span>
      <span id="ui-money">500</span>
    </div>
    <div class="stat-item stat-wave">
      <span id="ui-wave-label">ONDA 0/15</span>
    </div>
    <div class="stat-item stat-lives">
      <span class="stat-icon">♥</span>
      <span id="ui-lives">100</span>
    </div>
  </div>

  <!-- Canvas -->
  <div id="canvas-container">
    <canvas id="gameCanvas"></canvas>
    <!-- Tower popup -->
    <div id="tower-popup" class="hidden">
      <span class="popup-close" onclick="hideTowerPopup()">✕</span>
      <div class="popup-name" id="popup-name">RANGER</div>
      <div class="popup-rarity" id="popup-rarity">COMUM · NÍV 1</div>
      <div class="popup-stats" id="popup-stats"></div>
      <div class="popup-buttons" id="popup-buttons"></div>
    </div>
    <!-- Float messages -->
    <div id="float-messages"></div>
    <!-- Wave banner -->
    <div id="wave-banner"></div>
  </div>

  <!-- Footer -->
  <div id="game-footer">
    <div id="tower-carousel"></div>
    <div class="footer-controls">
      <button id="btn-start-wave" onclick="startWave()">▶ INICIAR ONDA</button>
      <div class="auto-toggle">
        <div class="auto-label">AUTO</div>
        <div class="toggle-switch" id="auto-toggle" onclick="toggleAuto()">
          <div class="toggle-knob"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ════════ SC